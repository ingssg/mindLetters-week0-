{% extends "layout.html" %} {% block content %}
<script
  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"
></script>

<style>
  dt,
  dd,
  h6 {
    display: inline;
  }

  #container {
    width: 50%;
    margin: auto;
    margin-top: 5%;
  }

  #info {
    display: inline;
    float: right;
  }
</style>
<div id="container">
  <h6>{% if article.topic=="good" %}칭찬해요{% else %}싫어요{% endif %}</h6>

  <dl id="info">
    <dt>작성자 :</dt>
    {% if article.is_blind %}
    <dd>익명</dd>
    {% else %}
    <dd>{{article.author}}</dd>
    {% endif %}
    <dt>생성일 :</dt>
    <dd>{{article.created_at}}</dd>
  </dl>

  <div class="input-group mb-3">
    <span class="input-group-text" id="basic-addon1">제목</span>
    <input
      type="text"
      class="form-control"
      aria-label="Username"
      aria-describedby="basic-addon1"
      value="{{article.title}}"
      disabled
    />
  </div>

  <div class="input-group">
    <span class="input-group-text">내용</span>
    <textarea
      class="form-control"
      aria-label="With textarea"
      rows="10"
      disabled
    >
{{article.body}}</textarea
    >
  </div>
  <br />

  <div id="blind-container" class="form-check">
    <input id="is-blind" class="form-check-input" type="checkbox" value=""
    id="flexCheckDefault">
    <label class="form-check-label" for="flexCheckDefault"> 익명 </label>
  </div>

  <div class="input-group mb-3">
    <textarea
      id="comment"
      class="form-control"
      aria-label="With textarea"
      rows="1"
    ></textarea>
    <button
      class="btn btn-outline-secondary"
      type="button"
      id="button-addon2"
      onclick="saveComment()"
    >
      입력
    </button>
  </div>
</div>

<script>
  function saveComment() {
    console.log("article", "{{article._id}}");
    let article = "{{article._id}}";
    let author = "{{author}}";
    let body = $("#comment").val();
    let is_blind = $('#is-blind').is(':checked');
    $.ajax({
      type: "POST",
      url: "/comments",
      headers: {
        "Content-type": "application/json",
        // Accept: "application/json",
      },
      data: JSON.stringify({
        article,
        author,
        body,
        updated_at: null,
        deleted_at: null,
        is_blind,
      }),
      success: function (response) {
        if (response["result"] == "success") {
          alert("댓글 등록 완료!");
          window.location.href = "/articles/" + "{{article._id}}";
        } else {
          alert("서버 오류!");
        }
      },
    });
  }
</script>
{% endblock %}
